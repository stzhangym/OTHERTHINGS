import React from 'react';
import { 
  BarChart, 
  Bar, 
  XAxis, 
  YAxis, 
  CartesianGrid, 
  Tooltip, 
  ResponsiveContainer, 
  Cell, 
  PieChart, 
  Pie, 
  Label
} from 'recharts';

/**
 * 优化后的体检指标可视化报告
 * 1. 采用通用 Flex 布局，解决显示不全的问题
 * 2. 优化 YAxis 文本宽度和图表内边距
 * 3. 增强移动端适配，确保在各种容器中都能完整显示
 */
const App = () => {
  // 核心数据
  const clinicalData = [
    { name: '总胆固醇', value: 6.28, refHigh: 5.6, unit: 'mmol/L', status: 'high' },
    { name: '促甲状腺素', value: 5.75, refHigh: 5.1, unit: 'mIU/L', status: 'high' },
    { name: '血尿酸', value: 358.4, refHigh: 340, unit: 'umol/L', status: 'high' },
    { name: '低密度脂蛋白', value: 3.32, refHigh: 3.37, unit: 'mmol/L', status: 'normal' },
  ];

  const riskDistribution = [
    { name: '异常项', value: 3, color: '#ef4444' },
    { name: '正常项', value: 45, color: '#10b981' },
    { name: '需关注项', value: 4, color: '#f59e0b' },
  ];

  // 自定义 Tooltip
  const CustomTooltip = ({ active, payload }) => {
    if (active && payload && payload.length) {
      const data = payload[0].payload;
      return (
        <div className="bg-white p-2 border border-gray-200 rounded shadow-md text-sm">
          <p className="font-bold border-b pb-1 mb-1">{data.name}</p>
          <p className="text-blue-600">数值: {data.value} {data.unit}</p>
          <p className="text-gray-400 text-xs">标准: ≤{data.refHigh}</p>
        </div>
      );
    }
    return null;
  };

  return (
    <div className="w-full min-h-screen bg-gray-50 p-2 sm:p-4 overflow-x-hidden">
      <div className="max-w-6xl mx-auto space-y-4">
        
        {/* 顶部标题 */}
        <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-wrap justify-between items-center gap-2">
          <div>
            <h1 className="text-xl font-bold text-gray-800">体检分析可视化预览</h1>
            <p className="text-gray-400 text-xs mt-0.5">数据来源：2025-12-19 体检报告</p>
          </div>
          <div className="text-right text-xs text-gray-500">
            <p>受检人: 刘女士</p>
            <p>年龄: 40岁</p>
          </div>
        </div>

        {/* 主图表区域 */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
          
          {/* 柱状对比图 */}
          <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 min-h-[350px]">
            <h3 className="text-sm font-bold mb-4 text-gray-700">重点异常指标对比</h3>
            <div className="h-[280px] w-full">
              <ResponsiveContainer width="100%" height="100%">
                <BarChart 
                  data={clinicalData} 
                  layout="vertical" 
                  margin={{ top: 5, right: 40, left: 10, bottom: 5 }}
                >
                  <CartesianGrid strokeDasharray="3 3" horizontal={false} stroke="#f3f4f6" />
                  <XAxis type="number" hide />
                  <YAxis 
                    dataKey="name" 
                    type="category" 
                    width={70}
                    tick={{ fontSize: 12, fill: '#6b7280' }}
                  />
                  <Tooltip content={<CustomTooltip />} />
                  <Bar dataKey="value" radius={[0, 4, 4, 0]} barSize={25}>
                    {clinicalData.map((entry, index) => (
                      <Cell key={index} fill={entry.status === 'high' ? '#f87171' : '#60a5fa'} />
                    ))}
                  </Bar>
                </BarChart>
              </ResponsiveContainer>
            </div>
            <div className="mt-2 text-[10px] text-gray-400 text-center italic">
              红色表示超出参考上限，蓝色表示在正常范围内
            </div>
          </div>

          {/* 饼图比例图 */}
          <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 min-h-[350px]">
            <h3 className="text-sm font-bold mb-4 text-center text-gray-700">体检项风险分布</h3>
            <div className="h-[260px] w-full">
              <ResponsiveContainer width="100%" height="100%">
                <PieChart>
                  <Pie
                    data={riskDistribution}
                    innerRadius={60}
                    outerRadius={80}
                    paddingAngle={5}
                    dataKey="value"
                  >
                    {riskDistribution.map((entry, index) => (
                      <Cell key={index} fill={entry.color} />
                    ))}
                    <Label 
                      value="健康度良好" 
                      position="center" 
                      style={{ fontSize: '12px', fill: '#9ca3af', fontWeight: 'bold' }} 
                    />
                  </Pie>
                  <Tooltip />
                </PieChart>
              </ResponsiveContainer>
            </div>
            <div className="grid grid-cols-3 gap-2 mt-4 text-[11px]">
              {riskDistribution.map((item, idx) => (
                <div key={idx} className="text-center">
                  <div className="w-2 h-2 rounded-full mx-auto mb-1" style={{ backgroundColor: item.color }}></div>
                  <div className="text-gray-500">{item.name}</div>
                  <div className="font-bold">{item.value}项</div>
                </div>
              ))}
            </div>
          </div>
        </div>

        {/* 底部摘要卡片 */}
        <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
          <h3 className="text-sm font-bold mb-3 text-gray-700">管理建议优先级</h3>
          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3">
            <div className="p-3 bg-red-50 rounded-lg border border-red-100">
              <p className="text-xs font-bold text-red-700 mb-1">甲状腺管理</p>
              <p className="text-[10px] text-red-600 leading-tight">TSH升高需关注亚临床甲减，建议3个月复查抗体。</p>
            </div>
            <div className="p-3 bg-blue-50 rounded-lg border border-blue-100">
              <p className="text-xs font-bold text-blue-700 mb-1">血脂干预</p>
              <p className="text-[10px] text-blue-600 leading-tight">胆固醇6.28，建议低饱和脂肪饮食，增加纤维摄入。</p>
            </div>
            <div className="p-3 bg-yellow-50 rounded-lg border border-yellow-100">
              <p className="text-xs font-bold text-yellow-700 mb-1">尿酸预防</p>
              <p className="text-[10px] text-yellow-600 leading-tight">尿酸临界高值，少喝肉汤，每日饮水保持2L以上。</p>
            </div>
            <div className="p-3 bg-green-50 rounded-lg border border-green-100">
              <p className="text-xs font-bold text-green-700 mb-1">定期随访</p>
              <p className="text-[10px] text-green-600 leading-tight">甲状腺及乳腺结节/增生均属2类，建议一年复查一次。</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default App;
