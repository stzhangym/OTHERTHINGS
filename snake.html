<!-- è‹±æ–‡æˆè¯­å°æŠ¥æ’å›¾ç”Ÿæˆå™¨ -->
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±æ–‡æˆè¯­å°æŠ¥ - ç”»è›‡æ·»è¶³</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f3e8; }
        /* è°ƒæ•´æœ€å¤§å®½åº¦ä»¥æ¨¡æ‹Ÿ 8K ç‰ˆé¢çš„å®½æ•æ„Ÿ */
        .newspaper-container {
            max-width: 1100px; 
            margin: 20px auto;
            background-color: #ffffff;
            border: 4px solid #6b4629;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            border-radius: 12px;
        }
        .header-title {
            color: #b91c1c;
            font-size: 2.5rem;
            text-align: center;
            font-weight: 700;
            padding-bottom: 10px;
            border-bottom: 3px solid #6b4629;
            margin-bottom: 20px;
        }
        .section-title {
            color: #38a169;
            font-weight: 600;
            font-size: 1.5rem;
            margin-top: 15px;
            margin-bottom: 8px;
            border-left: 5px solid #38a169;
            padding-left: 10px;
        }
        .button-primary {
            background-color: #38a169;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 600;
            box-shadow: 0 4px #2f855a;
        }
        .button-primary:hover {
            background-color: #2f855a;
        }
        .info-box {
            background-color: #ffe0b2;
            padding: 10px;
            border-radius: 6px;
            border: 1px dashed #6b4629;
        }
        .content-text {
            line-height: 1.6;
            color: #4a5568;
        }
    </style>
</head>
<body>

<div class="newspaper-container">

    <!-- æŠ¥å¤´åŒºï¼šäº”å¹´çº§ç®€åŒ–ç‰ˆ -->
    <h1 class="header-title">The Snake's Lesson: A Chinese Idiom Story</h1>
    <p class="text-center text-sm text-gray-600 mb-6">è‹±æ–‡æˆè¯­å°æŠ¥å®šç¨¿å†…å®¹ - ç”»è›‡æ·»è¶³ (HuÃ  ShÃ© TiÄn ZÃº)</p>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- å·¦ä¾§ï¼šæ’å›¾ç”ŸæˆåŒº -->
        <div class="col-span-1 border-r pr-6 border-gray-300">
            <h2 class="section-title text-center">æ’å›¾ç”Ÿæˆ (Illustration Area)</h2>
            <div id="image-container" class="mt-4 p-4 border border-gray-400 bg-gray-100 min-h-64 flex items-center justify-center rounded-lg shadow-inner">
                <img id="generated-image" src="" alt="Generated Illustration Placeholder" class="hidden max-w-full h-auto rounded-lg">
                <p id="image-placeholder" class="text-gray-500 text-center">
                    ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ç”Ÿæˆâ€œç”»è›‡æ·»è¶³â€æ•…äº‹åœºæ™¯æ’å›¾ã€‚
                    <br><small class="text-xs">ï¼ˆåœºæ™¯ï¼šå¤äººå¸­åœ°è€Œåï¼Œæœ‰äººåœ¨åœ°ä¸Šç”»è›‡ï¼Œé…’å›åœ¨æ—ã€‚ï¼‰</small>
                </p>
            </div>

            <button id="generate-button" class="button-primary w-full mt-4">ç”Ÿæˆå°æŠ¥æ’å›¾</button>
            <div id="loading-indicator" class="text-center text-sm mt-2 text-blue-600 hidden">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-500 inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                æ­£åœ¨ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™...
            </div>
            <div id="error-message" class="text-center text-sm mt-2 text-red-600 hidden"></div>

        </div>

        <!-- å³ä¾§ï¼šå°æŠ¥å†…å®¹å±•ç¤ºåŒº (å­—æ•°å‡å°‘) -->
        <div class="col-span-2">
            
            <!-- æ•…äº‹åŒºï¼šå­—æ•°å¤§å¹…å‡å°‘ -->
            <h2 class="section-title">ğŸ Section 1: The Story</h2>
            <h3 class="font-bold text-lg text-gray-700 ml-4">Subtitle: The Folly of Adding a Foot (å¤šæ­¤ä¸€ä¸¾çš„æ„šè ¢)</h3>
            <p class="content-text ml-4">A rich family rewarded their servants with a jar of wine. They decided to hold a drawing contest: the fastest person to draw a snake wins the wine.</p>
            <p class="content-text ml-4">One servant finished his snake very quickly. Feeling too proud, he drew four extra feet on it to show off his skill.</p>
            <p class="content-text ml-4">When another servant finished, he quickly took the wine. He said, "A snake does not have feet! You added something extra and spoiled the drawing."</p>
            <p class="content-text ml-4">The quick servant lost the wine because he did more than he needed to do.</p>

            <!-- é‡Šä¹‰ä¸å¯“æ„åŒºï¼šå­—æ•°å‡å°‘ -->
            <h2 class="section-title">ğŸ” Section 2: Idiom & Meaning</h2>
            <h3 class="font-bold text-lg text-gray-700 ml-4">Subtitle: What Does It Mean? (å®ƒçš„æ„æ€æ˜¯ä»€ä¹ˆ?)</h3>
            <div class="ml-4 content-text">
                <ul class="list-disc list-inside space-y-1">
                    <li>**Literal Translation:** Drawing a snake and adding feet.</li>
                    <li>**English Interpretation:** To spoil something good by adding things that are not needed.</li>
                </ul>
                <p class="mt-2 font-semibold">å¯“æ„ (The Moral):</p>
                <p>The lesson is: Stop when the job is done. Doing too much can spoil the result.</p>
            </div>

            <!-- æ–‡åŒ–å¯¹æ¯”åŒºï¼šå­—æ•°å‡å°‘ -->
            <h2 class="section-title">ğŸŒ Section 3: Cultural Bridge</h2>
            <h3 class="font-bold text-lg text-gray-700 ml-4">Subtitle: Bridging Wisdom: Similar English Expressions (ç›¸ä¼¼è‹±æ–‡è¡¨è¾¾)</h3>
            <div class="ml-4 mt-2">
                <table class="min-w-full border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100 text-gray-700 text-left">
                            <th class="py-2 px-4 border-b">English Expression</th>
                            <th class="py-2 px-4 border-b">Meaning</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="hover:bg-gray-50">
                            <td class="py-2 px-4 border-b">**Gild the lily.**</td>
                            <td class="py-2 px-4 border-b">Making perfect things better is needless.</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="py-2 px-4 border-b">**Less is more.**</td>
                            <td class="py-2 px-4 border-b">Simple is often best.</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="py-2 px-4 border-b">**To overkill.**</td>
                            <td class="py-2 px-4 border-b">Using too much effort.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- åŸºç¡€ä¿¡æ¯åŒº -->
    <div class="info-box mt-6 p-4 text-right">
        <p class="font-semibold">åŸºç¡€ä¿¡æ¯ (Basic Information):</p>
        <p>Chinese Idiom: **ç”»è›‡æ·»è¶³ (HuÃ  ShÃ© TiÄn ZÃº)**</p>
        <p>Class: Grade 5, Class 14</p>
        <p>Name: **[å§“å]**</p>
    </div>

    <!-- 8K çº¸å¼ å¸ƒå±€å‚è€ƒ (ä¾›æŠ„å†™æ—¶å‚è€ƒ) -->
    <div class="mt-8 p-4 bg-yellow-100 border border-yellow-400 rounded-lg">
        <h3 class="font-bold text-xl text-yellow-800">ğŸ“‹ 8K çº¸å¼ å¸ƒå±€æŒ‡å¯¼ (æŠ„å†™å‚è€ƒ)</h3>
        <p class="text-sm text-yellow-800 mt-2">
            è¯·å°† 8K çº¸å¼ **çºµå‘**æ”¾ç½®ï¼ˆçŸ­è¾¹åœ¨ä¸Šï¼‰ï¼Œå¹¶æŒ‰ä»¥ä¸‹æ¯”ä¾‹åˆ’åˆ†ï¼š
        </p>
        <ul class="list-disc list-inside ml-4 mt-2 text-yellow-900 text-base">
            <li>**é¡¶éƒ¨ (çº¦å  20%):** æ”¾ç½®æŠ¥å¤´ **"The Snake's Lesson..."**ï¼Œç¡®ä¿å­—ä½“æœ€å¤§ã€æœ€ç¾è§‚ã€‚</li>
            <li>**ä¸­é—´ä¸»ä½“ (çº¦å  70%):** åˆ’åˆ†ä¸º **3 ä¸ªçºµå‘åˆ—** (å¦‚é¢„è§ˆæ‰€ç¤º)ï¼š
                <ol class="ml-6 list-decimal">
                    <li>**å·¦åˆ— (1/3 å®½åº¦):** æ”¾ç½® **æ’å›¾ (Illustration Area)**ï¼Œå¹¶ç”¨è¾¹æ¡†ç¾åŒ–ã€‚</li>
                    <li>**ä¸­åˆ— (1/3 å®½åº¦):** æ”¾ç½® **Section 1: The Story (æ•…äº‹)**ï¼Œæ–‡å­—é‡æœ€å¤§ï¼Œå­—ä½“éœ€ç»Ÿä¸€æ¸…æ™°ã€‚</li>
                    <li>**å³åˆ— (1/3 å®½åº¦):** æ”¾ç½® **Section 2 & 3 (é‡Šä¹‰ã€å¯“æ„ã€æ–‡åŒ–å¯¹æ¯”)**ï¼Œå¯ä»¥ä½¿ç”¨è¡¨æ ¼å’Œè¾¹æ¡†çªå‡ºé‡ç‚¹ã€‚</li>
                </ol>
            </li>
            <li>**åº•éƒ¨ (çº¦å  10%):** æ”¾ç½®ç­çº§å’Œå§“åç­‰ **åŸºç¡€ä¿¡æ¯**ã€‚</li>
        </ul>
    </div>
</div>

<script>
    document.getElementById('generate-button').addEventListener('click', generateIllustration);

    const apiKey = ""; // Canvas will provide this automatically
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`;

    const generateButton = document.getElementById('generate-button');
    const loadingIndicator = document.getElementById('loading-indicator');
    const imagePlaceholder = document.getElementById('image-placeholder');
    const generatedImage = document.getElementById('generated-image');
    const imageContainer = document.getElementById('image-container');
    const errorMessage = document.getElementById('error-message');

    // Exponential backoff retry mechanism
    async function fetchWithRetry(url, options, maxRetries = 5) {
        let error = null;
        for (let i = 0; i < maxRetries; i++) {
            try {
                const response = await fetch(url, options);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (e) {
                error = e;
                const delay = Math.pow(2, i) * 1000;
                if (i < maxRetries - 1) {
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }
        throw error;
    }

    async function generateIllustration() {
        // ä¿æŒæ’å›¾æè¿°ä¸å˜ï¼Œä»¥ç¡®ä¿ç”Ÿæˆä¸­å›½ä¼ ç»Ÿé£æ ¼çš„æ’ç”»
        const prompt = "A traditional Chinese ink painting style illustration, depicting a scene from the Warring States Period. Several ancient men are sitting on the ground (Chu State style clothing). One man is actively drawing a snake on the dirt or a large flat stone with a stick. He looks smug and confident. A second man is watching him with a curious expression. A single, large terracotta wine jar is placed prominently next to them. The setting is rustic and historical.";

        const payload = { 
            instances: [{ prompt: prompt }], 
            parameters: { 
                "sampleCount": 1,
                "aspectRatio": "1:1" // Square image is generally good for small illustrations
            } 
        };

        generateButton.disabled = true;
        loadingIndicator.classList.remove('hidden');
        imagePlaceholder.classList.add('hidden');
        generatedImage.classList.add('hidden');
        errorMessage.classList.add('hidden');

        try {
            const response = await fetchWithRetry(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (response.predictions && response.predictions.length > 0 && response.predictions[0].bytesBase64Encoded) {
                const base64Data = response.predictions[0].bytesBase64Encoded;
                const imageUrl = `data:image/png;base64,${base64Data}`;
                generatedImage.src = imageUrl;
                generatedImage.onload = () => {
                    loadingIndicator.classList.add('hidden');
                    generatedImage.classList.remove('hidden');
                    imageContainer.style.backgroundColor = '#fff'; // Change background color after image loads
                };
                generatedImage.onerror = () => {
                    throw new Error("Failed to load generated image.");
                };
            } else {
                throw new Error("Image generation failed. No image data returned.");
            }
        } catch (error) {
            console.error("Error generating image:", error);
            errorMessage.textContent = `ç”Ÿæˆæ’å›¾å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚(${error.message})`;
            errorMessage.classList.remove('hidden');
            loadingIndicator.classList.add('hidden');
            imagePlaceholder.classList.remove('hidden');
            imageContainer.style.backgroundColor = '#f3f4f6';
        } finally {
            generateButton.disabled = false;
        }
    }
</script>

</body>
</html>
